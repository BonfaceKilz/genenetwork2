{% extends "base.html" %}
{% block title %}GNQNA{% endblock %}

{% block content %} <!-- Start of body -->
 

{% block css %}
<link rel="stylesheet" type="text/css" href="/static/new/css/markdown.css" />
<link rel="stylesheet" type="text/css" href="/static/new/css/llm.css">
{% endblock %}


<style type="text/css">

  #loader {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    background: rgba(0,0,0,0.75) url("/static/gif/loader.gif") no-repeat center center;
    z-index: 10000;
}


.btn{
  cursor: pointer;
  outline: 0;
  color: #AAA;

}

.btn:focus {
  outline: none;
}


.blue{
  color: blue;
}

.red{
  color: red;
}


</style>

<div style="height: 90vh;width: 100vw; margin-bottom: 10px;">

  <div id="loader">
    
  </div>
<div style="margin:10px; border:1px solid #ccc;padding: 15px;">
  <div >
    <h1 id="gnqa_query" style="font-weight: bolder">{{query}}<h1>
  </div>

  <div style="width:80vw;overflow-wrap: normal; margin-top: 5px;">
    <p style="word-spacing: 0.7em;" id="gnqa_answer">{{answer}} <p>
  </div>
</div>

<div>



      <div class="container" style="overflow-y: hidden;">
        <h4> <a href="#">References</a></h4>
        {% if references %}
            <ul id="gnqa_ref">
                {% for reference in references %}
                    <li id="gnqa_ref_item">
                        <h2 style="font-weight:bolder;">{{ reference.bibInfo }} </h2>
                        <p>{{reference.comboTxt}}</p>

                        <div class="rating" style="margin-right:20px;padding:5px;text-align: right;" data-doc-id="{{reference.doc_id}}" data-task-id="{{task_id['task_id']}}">

                             <button class="btn" id="green" data-toggle="tooltip" data-placement="top" title="rate this reference +1 "><i class="fa fa-thumbs-up fa-lg" aria-hidden="true"></i></button>
                             <button class="btn" id="red" data-toggle="tooltip" data-placement="top" title="rate this reference  -1"><i class="fa fa-thumbs-down fa-lg" aria-hidden="true"></i></button>
                            
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No references available.</p>
        {% endif %}
    </div>
</div>
</div>

<script src="https://use.fontawesome.com/fe459689b4.js"></script>
<script type="text/javascript">


     document.addEventListener('DOMContentLoaded', function() {
      const GN_SERVER_URL = {{gn_server_url|tojson}}
      console.log(GN_SERVER_URL)
        $('#globalsearchform').hide()
        $('#gnqna_search_home').show()
         $('footer').hide()
          $("#gnqna_search_home_input").keypress(function(event) {
            if (event.keyCode === 13) {
                console.log("clicked this button")
            $('#gnqna_search_home').submit();
            let spinner = $("#loader")
            spinner.show();

            }
        })


     $(".rating").each(function() {
        let  item = $(this);
        let  likeBtn = item.find("#green")
        let dislikeBtn = item.find("#red")


let voteRequest = (gn_server_url,task_id,doc_id,vote_count)=>{
    try{
    fetch(`${GN_SERVER_URL}/api/llm/rating/${task_id}/${doc_id}/${vote_count}`,{
        method:"POST",
        body:""
    })
    .then(response => response.text())
    .then(data=> console.log(data));
    }
    catch {
        alert("An error occurred")
    }
}
    likeBtn.on("click",function() {
    if(dislikeBtn.hasClass("red")){
        dislikeBtn.removeClass("red")
    }
    likeBtn.toggleClass("blue")
    likeBtn.hasClass("blue")? voteRequest(GN_SERVER_URL,item.data("taskId"),item.data("docId"),1) : 0 
})

dislikeBtn.on("click",function(){
if(likeBtn.hasClass("blue")){
        likeBtn.removeClass("blue")
    }
    dislikeBtn.toggleClass("red")
    likeBtn.hasClass("red") ? voteRequest(GN_SERVER_URL,item.data("taskId"),item.data("docId"),-1):0
})
 })
 })
</script>

{% endblock %}

